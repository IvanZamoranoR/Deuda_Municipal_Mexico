---
title: "Data_Cleaning"
output: html_document
date: "2025-01-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Mexico Public Debt Data Cleaning 
## Fuente: Secretaría de Hacienda y Crédito Público (SHCP) - Registro Público Único
## Link: https://www.disciplinafinanciera.hacienda.gob.mx/es/DISCIPLINA_FINANCIERA/Registro_Publico_Unico
## Authors Iván Zamorano, Rafael Ch

# Libraries

```{r chunk1}
#You can also use the pacman library if you want to read the rest of libraries with one command.
library(readxl)
library(dplyr)
library(magrittr)
library(openxlsx)
```


# Get the data (link in the source, XLSX file)
# We will ignore the first row since it only contains the tittle "FINANCIAMIENTOS Y OBLIGACIONES INSCRITOS EN EL REGISTRO PÚBLICO ÚNICO 1/".
# We will ignore the second row since it only contains blank spaces.
# We will remove the last 4 rows because they contain metadata that's not useful. 
# Renaming the column from "Saldo.total" to "2Q2019". 
# Renaming the column from "Entidad.Federativa" to "EntidadFed". 
# Data from: 20192Q - 20243Q


```{r get data , echo=FALSE}
Q22019 <- "Quarterly/02_04_2_trim_2019.xlsx"
Q2_2019 <- read.xlsx(Q22019, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("2Q2019" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "2Q2019")  # Select only the desired columns
print(Q2_2019rows <- nrow(Q2_2019))


Q3_2019 <- read_excel("Quarterly/02_04_3_trim_2019.xls", range = "A4:B100")
  #rename("3Q2019" = "Saldo.total") %>%
  #rename("EntidadFed" = "Entidad.federativa")  %>% 
  #select("3Q2019", "EntidadFed")
#print(Q3_2019rows <- nrow(Q3_2019))



merged_data1 <- left_join(Q2_2019, Q3_2019, by = "EntidadFed")
merged_data1


```

#Data Glimpse
```{r get data , echo=FALSE}
View(Q2_2019)
```

#Data Structure - Explanation:

* For Amount we used "Monto Original Contratado"
* For Maturirities we used "Fecha de Vencimiento" (note that there are some values)
* Other important dates are "Contract date", "Inscription Date" and "Days agreed for paying", we can add the "Contract date" or the "Inscription date" plus the "Days agreed for paying".
* For rates we used "Tasa Efectiva" but we can also use the "Tasa de interés", "Sobretasa", "Porcentaje Afectado" and "Tasa garantizada". 


```{r municipalities , echo=FALSE}
# Create a new data frame with rows containing "municipio"
registro_deuda_municipal_1 <- registro_deuda_1_[grepl("municipio", registro_deuda_1_$DEUDOR.U.OBLIGADO.2, ignore.case = TRUE), ]
# Create a new data frame with rows containing "municipal"

registro_deuda_municipal_2 <- registro_deuda_1_[grepl("municipal", registro_deuda_1_$DEUDOR.U.OBLIGADO.2, ignore.case = TRUE), ]
registro_deuda_municipal <- rbind(registro_deuda_municipal_1, registro_deuda_municipal_2)
registro_deuda_municipal <- registro_deuda_municipal[, c("MONTO.ORIGINAL.CONTRATADO.7/", "DEUDOR.U.OBLIGADO.2/", "FECHA.DE.VENCIMIENTO.27/", "TASA.EFECTIVA.13/")]
write.xlsx(registro_deuda_municipal, file = "registro_deuda_municipal.xlsx")
```


# Filter by states 
```{r municipalities , echo=FALSE}

# Create a new data frame with rows containing "Estado"
registro_deuda_estatal_1 <- registro_deuda_1_[grepl("Estado", registro_deuda_1_$DEUDOR.U.OBLIGADO.2, ignore.case = TRUE),]
# Create a new data frame with rows containing "Estatal"
registro_deuda_estatal_2 <- registro_deuda_1_[grepl("Estatal", registro_deuda_1_$DEUDOR.U.OBLIGADO.2, ignore.case = TRUE),]
registro_deuda_estatal <- rbind(registro_deuda_estatal_1, registro_deuda_estatal_2)
registro_deuda_estatal <- registro_deuda_estatal[, c("MONTO.ORIGINAL.CONTRATADO.7/", "DEUDOR.U.OBLIGADO.2/", "FECHA.DE.VENCIMIENTO.27/", "TASA.EFECTIVA.13/")]
write.xlsx(registro_deuda_estatal, file = "resgistro_deuda_estatal.xlsx")

```



title: "Data_Cleaning_Quarterly"
output: html_document
date: "2025-01-25"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
