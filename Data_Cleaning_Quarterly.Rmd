---
title: "Data_Cleaning"
output: html_document
date: "2025-01-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Mexico Public Debt Data Cleaning 
## Fuente: Secretaría de Hacienda y Crédito Público (SHCP) - Registro Público Único
## Link: https://www.disciplinafinanciera.hacienda.gob.mx/es/DISCIPLINA_FINANCIERA/Registro_Publico_Unico
## Authors Iván Zamorano, Rafael Ch

# Libraries

```{r chunk1}
#You can also use the pacman library if you want to read the rest of libraries with one command.
library(readxl)
library(dplyr)
library(magrittr)
library(openxlsx)
```


# Get the data (link in the source, XLSX file)
# We will ignore the first row since it only contains the tittle "FINANCIAMIENTOS Y OBLIGACIONES INSCRITOS EN EL REGISTRO PÚBLICO ÚNICO 1/".
# We will ignore the second row since it only contains blank spaces.
# We will remove the last 4 rows because they contain metadata that's not useful. 
# Renaming the column from "Saldo.total" to "2Q2019". 
# Renaming the column from "Entidad.Federativa" to "EntidadFed". 
# Data from: 20192Q - 20233Q



```{r get data 2024 , echo=FALSE}
############################ 2024 ############################    

Q12024 <- "Quarterly/02_04_1_trim_2024.xlsx"
Q1_2024 <- read.xlsx(Q12024, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("1Q2024" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.Federativa")  %>% 
  select("EntidadFed", "1Q2024")  # Select only the desired column
Q1_2024$id <- seq_len(nrow(Q1_2024))
print(Q1_2024rows <- nrow(Q1_2024))


Q22024 <- "Quarterly/02_04_2_trim_2023.xlsx"
Q2_2024 <- read.xlsx(Q22024, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("2Q2024" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.Federativa")  %>% 
  select("EntidadFed", "2Q2024")  # Select only the desired column
Q2_2024$id <- seq_len(nrow(Q2_2024))
print(Q2_2024rows <- nrow(Q2_2024))


Q32024 <- "Quarterly/02_04_3_trim_2023.xlsx"
Q3_2024 <- read.xlsx(Q32024, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("3Q2024" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.Federativa")  %>% 
  select("EntidadFed", "3Q2024")  # Select only the desired column
Q3_2024$id <- seq_len(nrow(Q3_2024))
print(Q3_2024rows <- nrow(Q3_2024))

merged_data_2024 <- Q1_2024 %>%
  left_join(Q2_2024, by = "id") %>%
  left_join(Q3_2024, by = "id") 

merged_data_2024  <- merged_data_2024 %>%
  select(-EntidadFed.y, -EntidadFed, -EntidadFed.x)

```



```{r get data 2023 , echo=FALSE}
############################ 2023 ############################    

Q12023 <- "Quarterly/02_04_1_trim_2023.xlsx"
Q1_2023 <- read.xlsx(Q12023, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("1Q2023" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "1Q2023")  # Select only the desired column
Q1_2023$id <- seq_len(nrow(Q1_2023))
print(Q1_2023rows <- nrow(Q1_2023))


Q22023 <- "Quarterly/02_04_2_trim_2023.xlsx"
Q2_2023 <- read.xlsx(Q22023, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("2Q2023" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.Federativa")  %>% 
  select("EntidadFed", "2Q2023")  # Select only the desired column
Q2_2023$id <- seq_len(nrow(Q2_2023))
print(Q2_2023rows <- nrow(Q2_2023))


Q32023 <- "Quarterly/02_04_3_trim_2023.xlsx"
Q3_2023 <- read.xlsx(Q32023, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("3Q2023" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.Federativa")  %>% 
  select("EntidadFed", "3Q2023")  # Select only the desired column
Q3_2023$id <- seq_len(nrow(Q3_2023))
print(Q3_2023rows <- nrow(Q3_2023))


Q42023 <- "Quarterly/02_04_4_trim_2023.xlsx"
Q4_2023 <- read.xlsx(Q42023, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("4Q2023" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.Federativa")  %>% 
  select("EntidadFed", "4Q2023")  # Select only the desired column
Q4_2023$id <- seq_len(nrow(Q4_2023))
print(Q4_2023rows <- nrow(Q4_2023))

merged_data_2023 <- Q1_2023 %>%
  left_join(Q2_2023, by = "id") %>%
  left_join(Q3_2023, by = "id") %>%
  left_join(Q4_2023, by = "id")

merged_data_2023  <- merged_data_2023 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```

```{r get data 2022 , echo=FALSE}
############################ 2022 ############################    

Q12022 <- "Quarterly/02_04_1_trim_2022.xlsx"
Q1_2022 <- read.xlsx(Q12022, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("1Q2022" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "1Q2022")  # Select only the desired column
Q1_2022$id <- seq_len(nrow(Q1_2022))
print(Q1_2022rows <- nrow(Q1_2022))


Q22022 <- "Quarterly/02_04_2_trim_2022.xlsx"
Q2_2022 <- read.xlsx(Q22022, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("2Q2022" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "2Q2022")  # Select only the desired column
Q2_2022$id <- seq_len(nrow(Q2_2022))
print(Q2_2022rows <- nrow(Q2_2022))


Q32022 <- "Quarterly/02_04_3_trim_2022.xlsx"
Q3_2022 <- read.xlsx(Q32022, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("3Q2022" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "3Q2022")  # Select only the desired column
Q3_2022$id <- seq_len(nrow(Q3_2022))
print(Q3_2022rows <- nrow(Q3_2022))


Q42022 <- "Quarterly/02_04_4_trim_2022 (1).xlsx"
Q4_2022 <- read.xlsx(Q42022, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("4Q2022" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "4Q2022")  # Select only the desired column
Q4_2022$id <- seq_len(nrow(Q4_2022))
print(Q4_2022rows <- nrow(Q4_2022))

merged_data_2022 <- Q1_2022 %>%
  left_join(Q2_2022, by = "id") %>%
  left_join(Q3_2022, by = "id") %>%
  left_join(Q4_2022, by = "id")

merged_data_2022  <- merged_data_2022 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```


```{r get data 2021 , echo=FALSE}
############################ 2021 ############################    

Q1_2021 <- read_excel("Quarterly/02_04_1_trim_2021.xls", range = "A4:F2487") %>%
  slice(1:(n() - 4)) %>% 
  rename("1Q2021" = "Saldo total") %>%
  rename("EntidadFed" = "Entidad federativa")  %>% 
  select("EntidadFed", "1Q2021")

Q1_2021$id <- seq_len(nrow(Q1_2021))
print(Q1_2021rows <- nrow(Q1_2021))


Q2_2021 <- read_excel("Quarterly/02_04_2_trim_2021.xls", range = "A4:F2487") %>%
  slice(1:(n() - 4)) %>% 
  rename("2Q2021" = "Saldo total") %>%
  rename("EntidadFed" = "Entidad federativa")  %>% 
  select("EntidadFed", "2Q2021")

Q2_2021$id <- seq_len(nrow(Q2_2021))
print(Q2_2021rows <- nrow(Q2_2021))


Q32021 <- "Quarterly/02_04_3_trim_2021.xlsx"
Q3_2021 <- read.xlsx(Q32021, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("3Q2021" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "3Q2021")  # Select only the desired column

Q3_2021$id <- seq_len(nrow(Q3_2021))
print(Q3_2021rows <- nrow(Q3_2021))

Q42021 <- "Quarterly/02_04_4_trim_2021.xlsx"
Q4_2021 <- read.xlsx(Q42021, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("4Q2021" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "4Q2021")  # Select only the desired column

Q4_2021$id <- seq_len(nrow(Q4_2021))
print(Q4_2021rows <- nrow(Q4_2021))

merged_data_2021 <- Q1_2021 %>%
  left_join(Q2_2021, by = "id") %>%
  left_join(Q3_2021, by = "id") %>%
  left_join(Q4_2021, by = "id")

merged_data_2021  <- merged_data_2021 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```

```{r get data 2020 , echo=FALSE}

############################ 2020 ############################    

Q1_2020 <- read_excel("Quarterly/02_04_1_trim_2020.xls", range = "A4:F2487") %>%
  slice(1:(n() - 4)) %>% 
  rename("1Q2020" = "Saldo total") %>%
  rename("EntidadFed" = "Entidad federativa")  %>% 
  select("EntidadFed", "1Q2020")

Q1_2020$id <- seq_len(nrow(Q1_2020))
print(Q1_2020rows <- nrow(Q1_2020))



Q2_2020 <- read_excel("Quarterly/02_04_2_trim_2020.xls", range = "A4:F2487") %>%
  slice(1:(n() - 4)) %>% 
  rename("2Q2020" = "Saldo total") %>%
  rename("EntidadFed" = "Entidad federativa")  %>% 
  select("EntidadFed", "2Q2020")

Q2_2020$id <- seq_len(nrow(Q2_2020))
print(Q2_2020rows <- nrow(Q2_2020))



Q3_2020 <- read_excel("Quarterly/02_04_3_trim_2020.xls", range = "A4:F2487") %>%
  slice(1:(n() - 4)) %>% 
  rename("3Q2020" = "Saldo total") %>%
  rename("EntidadFed" = "Entidad federativa")  %>% 
  select("EntidadFed", "3Q2020")

Q3_2020$id <- seq_len(nrow(Q3_2020))
print(Q3_2020rows <- nrow(Q3_2020))



Q4_2020 <- read_excel("Quarterly/02_04_4_trim_2020.xls", range = "A4:F2487") %>%
  slice(1:(n() - 4)) %>% 
  rename("4Q2020" = "Saldo total") %>%
  rename("EntidadFed" = "Entidad federativa")  %>% 
  select("EntidadFed", "4Q2020")
print(Q3_2020rows <- nrow(Q4_2020))

Q4_2020$id <- seq_len(nrow(Q4_2020))
print(Q4_2020rows <- nrow(Q4_2020))

merged_data_2020 <- Q1_2020 %>%
  left_join(Q2_2020, by = "id") %>%
  left_join(Q3_2020, by = "id") %>%
  left_join(Q4_2020, by = "id")

merged_data_2020  <- merged_data_2020 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)
```


```{r get data 2019 , echo=FALSE}
############################ 2019 ############################    

Q22019 <- "Quarterly/02_04_2_trim_2019.xlsx"
Q2_2019 <- read.xlsx(Q22019, startRow = 4) %>%
  slice(1:(n() - 4)) %>% 
  rename("2Q2019" = "Saldo.total")  %>% 
  rename("EntidadFed" = "Entidad.federativa")  %>% 
  select("EntidadFed", "2Q2019")  # Select only the desired columns

Q2_2019$id <- seq_len(nrow(Q2_2019))
print(Q2_2019rows <- nrow(Q2_2019))



Q3_2019 <- read_excel("Quarterly/02_04_3_trim_2019.xls", range = "A4:F2487") %>%
  slice(1:(n() - 4)) %>% 
  rename("3Q2019" = "Saldo total") %>%
  rename("EntidadFed" = "Entidad federativa")  %>% 
  select("EntidadFed", "3Q2019")
Q3_2019$id <- seq_len(nrow(Q3_2019))
print(Q3_2019rows <- nrow(Q3_2019))


Q4_2019 <- read_excel("Quarterly/02_04_4_trim_2019.xls", range = "A4:F2487") %>%
  slice(1:(n() - 4)) %>% 
  rename("4Q2019" = "Saldo total") %>%
  rename("EntidadFed" = "Entidad federativa")  %>% 
  select("EntidadFed", "4Q2019")
Q4_2019$id <- seq_len(nrow(Q4_2019))
print(Q4_20219rows <- nrow(Q4_2019))



merged_data_2019 <- Q2_2019 %>%
  left_join(Q3_2019, by = "id") %>%
  left_join(Q4_2019, by = "id")

merged_data_2019  <- merged_data_2019 %>%
  select(-EntidadFed.y, -EntidadFed.x)


merged_data_2019_2020 <- merged_data_2019 %>%
  left_join(merged_data_2020, by = "id")

merged_data_2019_2020   <- merged_data_2019_2020 %>%
  select(-EntidadFed.x, -id)


```


```{r get data 2018 , echo=FALSE}
############################ 2018 ############################    

library(tidyr)

Q12018 <- read_excel("Quarterly/02_04_1_trim_2018.xlsx", skip = 1)

colnames(Q12018)[1] <- "Entidad.federativa"
colnames(Q12018)[2] <- "Saldo.total"

Q1_2018 <- Q12018 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2018` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2018`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2018$id <- seq_len(nrow(Q1_2018))


Q22018 <- read_excel("Quarterly/02_04_2_trim_2018.xlsx", skip = 1)

colnames(Q22018)[1] <- "Entidad.federativa"
colnames(Q22018)[2] <- "Saldo.total"

Q2_2018 <- Q22018 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2018` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2018`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2018$id <- seq_len(nrow(Q2_2018))

Q32018 <- read_excel("Quarterly/02_04_3_trim_2018.xlsx", skip = 1)

colnames(Q32018)[1] <- "Entidad.federativa"
colnames(Q32018)[2] <- "Saldo.total"

Q3_2018 <- Q32018 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2018` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2018`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA

Q3_2018$id <- seq_len(nrow(Q3_2018))


Q42018 <- read_excel("Quarterly/02_04_4_trim_2018.xlsx", skip = 1)

colnames(Q42018)[1] <- "Entidad.federativa"
colnames(Q42018)[2] <- "Saldo.total"

Q4_2018 <- Q42018 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2018` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2018`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA

Q4_2018$id <- seq_len(nrow(Q4_2018))

merged_data_2018 <- Q1_2018 %>%
  left_join(Q2_2018, by = "id") %>%
  left_join(Q3_2018, by = "id") %>%
  left_join(Q4_2018, by = "id")

merged_data_2018  <- merged_data_2018 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```


```{r get data 2017 , echo=FALSE}
############################ 2017 ############################    

library(tidyr)

Q12017 <- read_excel("Quarterly/02_04_1_trim_2017.xlsx", skip = 1)
colnames(Q12017)[1] <- "Entidad.federativa"
colnames(Q12017)[2] <- "Saldo.total"

Q1_2017 <- Q12017 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2017` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2017`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2017$id <- seq_len(nrow(Q1_2017))


Q22017 <- read_excel("Quarterly/02_04_2_trim_2017.xlsx", skip = 1)
colnames(Q22017)[1] <- "Entidad.federativa"
colnames(Q22017)[2] <- "Saldo.total"

Q2_2017 <- Q22017 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2017` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2017`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2017$id <- seq_len(nrow(Q2_2017))


Q32017 <- read_excel("Quarterly/02_04_3_trim_2017.xlsx", skip = 1)
colnames(Q32017)[1] <- "Entidad.federativa"
colnames(Q32017)[2] <- "Saldo.total"

Q3_2017 <- Q32017 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2017` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2017`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2017$id <- seq_len(nrow(Q3_2017))


Q42017 <- read_excel("Quarterly/02_04_4_trim_2017.xlsx", skip = 1)
colnames(Q42017)[1] <- "Entidad.federativa"
colnames(Q42017)[2] <- "Saldo.total"

Q4_2017 <- Q42017 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2017` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2017`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2017$id <- seq_len(nrow(Q4_2017))

merged_data_2017 <- Q1_2017 %>%
  left_join(Q2_2017, by = "id") %>%
  left_join(Q3_2017, by = "id") %>%
  left_join(Q4_2017, by = "id")

merged_data_2017  <- merged_data_2017 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```




```{r get data 2016 , echo=FALSE}
############################ 2016 ############################ CHECK     

library(tidyr)

Q12016 <- read_excel("Quarterly/02_04_1_trim_2017.xlsx", skip = 1)
colnames(Q12016)[1] <- "Entidad.federativa"
colnames(Q12016)[2] <- "Saldo.total"

Q1_2016 <- Q12016 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2016` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2016`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2016$id <- seq_len(nrow(Q1_2016))


Q22016 <- read_excel("Quarterly/02_04_2_trim_2016.xlsx", skip = 1)
colnames(Q22016)[1] <- "Entidad.federativa"
colnames(Q22016)[2] <- "Saldo.total"

Q2_2016 <- Q22016 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2016` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2016`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2016$id <- seq_len(nrow(Q2_2016))


#Q32017 <- read_excel("Quarterly/02_04_3_trim_2017.xlsx", skip = 1)
#colnames(Q32017)[1] <- "Entidad.federativa"
#colnames(Q32017)[2] <- "Saldo.total"

#Q3_2017 <- Q32017 %>%
#  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
#  rename(`3Q2017` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
#  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
#  select(EntidadFed, `3Q2017`) %>%      # Select only the desired columns
#  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
#Q3_2017$id <- seq_len(nrow(Q3_2017))


#Q42017 <- read_excel("Quarterly/02_04_4_trim_2017.xlsx", skip = 1)
#colnames(Q42017)[1] <- "Entidad.federativa"
#colnames(Q42017)[2] <- "Saldo.total"

#Q4_2017 <- Q42017 %>%
#  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
#  rename(`4Q2017` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
#  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
#  select(EntidadFed, `4Q2017`) %>%      # Select only the desired columns
#  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
#Q4_2017$id <- seq_len(nrow(Q4_2017))

#merged_data_2017 <- Q1_2017 %>%
#  left_join(Q2_2017, by = "id") %>%
#  left_join(Q3_2017, by = "id") %>%
#  left_join(Q4_2017, by = "id")

#merged_data_2017  <- merged_data_2017 %>%
#  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```

```{r get data 2015 , echo=FALSE}
############################ 2015 ############################    

library(tidyr)

Q12015 <- read_excel("Quarterly/02_04_1_trim_2015.xlsx", skip = 1)
colnames(Q12015)[1] <- "Entidad.federativa"
colnames(Q12015)[2] <- "Saldo.total"

Q1_2015 <- Q12015 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2015` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2015`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2015$id <- seq_len(nrow(Q1_2015))


Q22015 <- read_excel("Quarterly/02_04_2_trim_2015.xlsx", skip = 1)
colnames(Q22015)[1] <- "Entidad.federativa"
colnames(Q22015)[2] <- "Saldo.total"

Q2_2015 <- Q22015 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2015` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2015`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2015$id <- seq_len(nrow(Q2_2015))


Q32015 <- read_excel("Quarterly/02_04_3_trim_2015.xlsx", skip = 1)
colnames(Q32015)[1] <- "Entidad.federativa"
colnames(Q32015)[2] <- "Saldo.total"

Q3_2015 <- Q32015 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2015` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2015`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2015$id <- seq_len(nrow(Q3_2015))


Q42015 <- read_excel("Quarterly/02_04_4_trim_2015.xlsx", skip = 1)
colnames(Q42015)[1] <- "Entidad.federativa"
colnames(Q42015)[2] <- "Saldo.total"

Q4_2015 <- Q42015 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2015` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2015`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2015$id <- seq_len(nrow(Q4_2015))

merged_data_2015 <- Q1_2015 %>%
  left_join(Q2_2015, by = "id") %>%
  left_join(Q3_2015, by = "id") %>%
  left_join(Q4_2015, by = "id")

merged_data_2015  <- merged_data_2015 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```



```{r get data 2014 , echo=FALSE}
############################ 2014 ############################    

library(tidyr)

Q12014 <- read_excel("Quarterly/02_04_1_trim_2014.xlsx", skip = 1)
colnames(Q12014)[1] <- "Entidad.federativa"
colnames(Q12014)[2] <- "Saldo.total"

Q1_2014 <- Q12014 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2014` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2014`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2014$id <- seq_len(nrow(Q1_2014))


Q22014 <- read_excel("Quarterly/02_04_2_trim_2014.xlsx", skip = 1)
colnames(Q22014)[1] <- "Entidad.federativa"
colnames(Q22014)[2] <- "Saldo.total"

Q2_2014 <- Q22014 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2014` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2014`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2014$id <- seq_len(nrow(Q2_2014))


Q32014 <- read_excel("Quarterly/02_04_3_trim_2014.xlsx", skip = 1)
colnames(Q32014)[1] <- "Entidad.federativa"
colnames(Q32014)[2] <- "Saldo.total"

Q3_2014 <- Q32014 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2014` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2014`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2014$id <- seq_len(nrow(Q3_2014))


Q42014 <- read_excel("Quarterly/02_04_4_trim_2014.xlsx", skip = 1)
colnames(Q42014)[1] <- "Entidad.federativa"
colnames(Q42014)[2] <- "Saldo.total"

Q4_2014 <- Q42014 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2014` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2014`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2014$id <- seq_len(nrow(Q4_2014))

merged_data_2014 <- Q1_2014 %>%
  left_join(Q2_2014, by = "id") %>%
  left_join(Q3_2014, by = "id") %>%
  left_join(Q4_2014, by = "id")

merged_data_2014  <- merged_data_2014 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```




```{r get data 2013 , echo=FALSE}
############################ 2013 ############################    

library(tidyr)

Q12013 <- read_excel("Quarterly/02_04_1_trim_2013.xlsx", skip = 1)
colnames(Q12013)[1] <- "Entidad.federativa"
colnames(Q12013)[2] <- "Saldo.total"

Q1_2013 <- Q12013 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2013` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2013`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2013$id <- seq_len(nrow(Q1_2013))


Q22013 <- read_excel("Quarterly/02_04_2_trim_2013.xlsx", skip = 1)
colnames(Q22013)[1] <- "Entidad.federativa"
colnames(Q22013)[2] <- "Saldo.total"

Q2_2013 <- Q22013 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2013` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2013`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2013$id <- seq_len(nrow(Q2_2013))


Q32013 <- read_excel("Quarterly/02_04_3_trim_2013.xlsx", skip = 1)
colnames(Q32013)[1] <- "Entidad.federativa"
colnames(Q32013)[2] <- "Saldo.total"

Q3_2013 <- Q32013 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2013` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2013`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2013$id <- seq_len(nrow(Q3_2013))


Q42013 <- read_excel("Quarterly/02_04_4_trim_2013.xlsx", skip = 1)
colnames(Q42013)[1] <- "Entidad.federativa"
colnames(Q42013)[2] <- "Saldo.total"

Q4_2013 <- Q42013 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2013` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2013`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2013$id <- seq_len(nrow(Q4_2013))

merged_data_2013 <- Q1_2013 %>%
  left_join(Q2_2013, by = "id") %>%
  left_join(Q3_2013, by = "id") %>%
  left_join(Q4_2013, by = "id")

merged_data_2013  <- merged_data_2013 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```




```{r get data 2012 , echo=FALSE}
############################ 2012 ############################    

library(tidyr)

Q12012 <- read_excel("Quarterly/02_04_1_trim_2012.xlsx", skip = 1)
colnames(Q12012)[1] <- "Entidad.federativa"
colnames(Q12012)[2] <- "Saldo.total"

Q1_2012 <- Q12012 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2012` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2012`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2012$id <- seq_len(nrow(Q1_2012))


Q22012 <- read_excel("Quarterly/02_04_2_trim_2012.xlsx", skip = 1)
colnames(Q22012)[1] <- "Entidad.federativa"
colnames(Q22012)[2] <- "Saldo.total"

Q2_2012 <- Q22012 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2012` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2012`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2012$id <- seq_len(nrow(Q2_2012))


Q32012 <- read_excel("Quarterly/02_04_3_trim_2012.xlsx", skip = 1)
colnames(Q32012)[1] <- "Entidad.federativa"
colnames(Q32012)[2] <- "Saldo.total"

Q3_2012 <- Q32012 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2012` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2012`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2012$id <- seq_len(nrow(Q3_2012))


Q42012 <- read_excel("Quarterly/02_04_4_trim_2012.xlsx", skip = 1)
colnames(Q42012)[1] <- "Entidad.federativa"
colnames(Q42012)[2] <- "Saldo.total"

Q4_2012 <- Q42012 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2012` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2012`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2012$id <- seq_len(nrow(Q4_2012))

merged_data_2012 <- Q1_2012 %>%
  left_join(Q2_2012, by = "id") %>%
  left_join(Q3_2012, by = "id") %>%
  left_join(Q4_2012, by = "id")

merged_data_2012  <- merged_data_2012 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```


```{r get data 2011 , echo=FALSE}
############################ 2011 ############################    

library(tidyr)

Q12011 <- read_excel("Quarterly/02_04_1_trim_201.xlsx", skip = 1)
colnames(Q12011)[1] <- "Entidad.federativa"
colnames(Q12011)[2] <- "Saldo.total"

Q1_2011 <- Q12011 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2011` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2011`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2011$id <- seq_len(nrow(Q1_2011))


Q22011 <- read_excel("Quarterly/02_04_2_trim_2011.xlsx", skip = 1)
colnames(Q22011)[1] <- "Entidad.federativa"
colnames(Q22011)[2] <- "Saldo.total"

Q2_2011 <- Q2201 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2011` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2011`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2011$id <- seq_len(nrow(Q2_2011))


Q32011 <- read_excel("Quarterly/02_04_3_trim_2011.xlsx", skip = 1)
colnames(Q32011)[1] <- "Entidad.federativa"
colnames(Q32011)[2] <- "Saldo.total"

Q3_2011 <- Q32011 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2011` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2011`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2011$id <- seq_len(nrow(Q3_2011))


Q42011 <- read_excel("Quarterly/02_04_4_trim_2011.xlsx", skip = 1)
colnames(Q42011)[1] <- "Entidad.federativa"
colnames(Q42011)[2] <- "Saldo.total"

Q4_2011 <- Q42011 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2011` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2011`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2011$id <- seq_len(nrow(Q4_2011))

merged_data_2011 <- Q1_2011 %>%
  left_join(Q2_2011, by = "id") %>%
  left_join(Q3_2011, by = "id") %>%
  left_join(Q4_2011, by = "id")

merged_data_2011  <- merged_data_2011 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```


```{r get data 2010 , echo=FALSE}
############################ 2010 ############################    

library(tidyr)

Q12010 <- read_excel("Quarterly/02_04_1_trim_2010.xlsx", skip = 1)
colnames(Q12010)[1] <- "Entidad.federativa"
colnames(Q12010)[2] <- "Saldo.total"

Q1_2010 <- Q12010 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2010` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2010`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2010$id <- seq_len(nrow(Q1_2010))


Q22010 <- read_excel("Quarterly/02_04_2_trim_2010.xlsx", skip = 1)
colnames(Q22010)[1] <- "Entidad.federativa"
colnames(Q22010)[2] <- "Saldo.total"

Q2_2010 <- Q22010 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2010` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2010`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2010$id <- seq_len(nrow(Q2_2010))


Q32010 <- read_excel("Quarterly/02_04_3_trim_2010.xlsx", skip = 1)
colnames(Q32010)[1] <- "Entidad.federativa"
colnames(Q32010)[2] <- "Saldo.total"

Q3_2010 <- Q32010 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2010` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2010`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2010$id <- seq_len(nrow(Q3_2010))


Q42010 <- read_excel("Quarterly/02_04_4_trim_2010.xlsx", skip = 1)
colnames(Q42010)[1] <- "Entidad.federativa"
colnames(Q42010)[2] <- "Saldo.total"

Q4_2010 <- Q42010 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2010` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2010`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2010$id <- seq_len(nrow(Q4_2010))

merged_data_2010 <- Q1_2010 %>%
  left_join(Q2_2010, by = "id") %>%
  left_join(Q3_2010, by = "id") %>%
  left_join(Q4_2010, by = "id")

merged_data_2010  <- merged_data_2010 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```


```{r get data 2009 , echo=FALSE}
############################ 2009 ############################    

library(tidyr)

Q12009 <- read_excel("Quarterly/02_04_1_trim_2009.xlsx", skip = 1)
colnames(Q12009)[1] <- "Entidad.federativa"
colnames(Q12009)[2] <- "Saldo.total"

Q1_2009 <- Q12009 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2009` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2009`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2009$id <- seq_len(nrow(Q1_2009))


Q22009 <- read_excel("Quarterly/02_04_2_trim_2009.xlsx", skip = 1)
colnames(Q22009)[1] <- "Entidad.federativa"
colnames(Q22009)[2] <- "Saldo.total"

Q2_2009 <- Q22009 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2009` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2009`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2009$id <- seq_len(nrow(Q2_2009))


Q32009 <- read_excel("Quarterly/02_04_3_trim_2009.xlsx", skip = 1)
colnames(Q32009)[1] <- "Entidad.federativa"
colnames(Q32009)[2] <- "Saldo.total"

Q3_2009 <- Q32009 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2009` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2009`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2009$id <- seq_len(nrow(Q3_2009))


Q42009 <- read_excel("Quarterly/02_04_4_trim_2009.xlsx", skip = 1)
colnames(Q42009)[1] <- "Entidad.federativa"
colnames(Q42009)[2] <- "Saldo.total"

Q4_2009 <- Q42009 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2009` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2009`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2009$id <- seq_len(nrow(Q4_2009))

merged_data_2009 <- Q1_2009 %>%
  left_join(Q2_2009, by = "id") %>%
  left_join(Q3_2009, by = "id") %>%
  left_join(Q4_2009, by = "id")

merged_data_2009  <- merged_data_2009 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```



```{r get data 2008 , echo=FALSE}
############################ 2008 ############################    

library(tidyr)

Q12008 <- read_excel("Quarterly/02_04_1_trim_2008.xlsx", skip = 1)
colnames(Q12008)[1] <- "Entidad.federativa"
colnames(Q12008)[2] <- "Saldo.total"

Q1_2008 <- Q12008 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2008` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2008`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2008$id <- seq_len(nrow(Q1_2008))


Q22008 <- read_excel("Quarterly/02_04_2_trim_2008.xlsx", skip = 1)
colnames(Q22008)[1] <- "Entidad.federativa"
colnames(Q22008)[2] <- "Saldo.total"

Q2_2008 <- Q22008 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2008` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2008`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2008$id <- seq_len(nrow(Q2_2008))


Q32008 <- read_excel("Quarterly/02_04_3_trim_2008.xlsx", skip = 1)
colnames(Q32008)[1] <- "Entidad.federativa"
colnames(Q32008)[2] <- "Saldo.total"

Q3_2008 <- Q32008 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2008` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2008`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2008$id <- seq_len(nrow(Q3_2008))


Q42008 <- read_excel("Quarterly/02_04_4_trim_2008.xlsx", skip = 1)
colnames(Q42008)[1] <- "Entidad.federativa"
colnames(Q42008)[2] <- "Saldo.total"

Q4_2008 <- Q42008 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2008` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2008`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2008$id <- seq_len(nrow(Q4_2008))

merged_data_2008 <- Q1_2008 %>%
  left_join(Q2_2008, by = "id") %>%
  left_join(Q3_2008, by = "id") %>%
  left_join(Q4_2008, by = "id")

merged_data_2008  <- merged_data_2008 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```



```{r get data 2007 , echo=FALSE}
############################ 2007 ############################    

library(tidyr)

Q12007 <- read_excel("Quarterly/02_04_1_trim_2007.xlsx", skip = 1)
colnames(Q12007)[1] <- "Entidad.federativa"
colnames(Q12007)[2] <- "Saldo.total"

Q1_2007 <- Q12007 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2007` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2007`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2007$id <- seq_len(nrow(Q1_2007))


Q22007 <- read_excel("Quarterly/02_04_2_trim_2007.xlsx", skip = 1)
colnames(Q22007)[1] <- "Entidad.federativa"
colnames(Q22007)[2] <- "Saldo.total"

Q2_2007 <- Q22007 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2007` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2007`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2007$id <- seq_len(nrow(Q2_2007))


Q32007 <- read_excel("Quarterly/02_04_3_trim_2007.xlsx", skip = 1)
colnames(Q32007)[1] <- "Entidad.federativa"
colnames(Q32007)[2] <- "Saldo.total"

Q3_2007 <- Q32007 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2007` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2007`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2007$id <- seq_len(nrow(Q3_2007))


Q42007 <- read_excel("Quarterly/02_04_4_trim_2007.xlsx", skip = 1)
colnames(Q42007)[1] <- "Entidad.federativa"
colnames(Q42007)[2] <- "Saldo.total"

Q4_2007 <- Q42007 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2007` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2007`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2007$id <- seq_len(nrow(Q4_2007))

merged_data_2007 <- Q1_2007 %>%
  left_join(Q2_2007, by = "id") %>%
  left_join(Q3_2007, by = "id") %>%
  left_join(Q4_2007, by = "id")

merged_data_2007  <- merged_data_2007 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```



```{r get data 2006 , echo=FALSE}
############################ 2006 ############################    

library(tidyr)

Q12006 <- read_excel("Quarterly/02_04_1_trim_2006.xlsx", skip = 1)
colnames(Q12006)[1] <- "Entidad.federativa"
colnames(Q12006)[2] <- "Saldo.total"

Q1_2006 <- Q12006 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2006` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2006`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2006$id <- seq_len(nrow(Q1_2006))


Q22006 <- read_excel("Quarterly/02_04_2_trim_2006.xlsx", skip = 1)
colnames(Q22006)[1] <- "Entidad.federativa"
colnames(Q22006)[2] <- "Saldo.total"

Q2_2006 <- Q22006 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2006` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2006`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2006$id <- seq_len(nrow(Q2_2006))


Q32006 <- read_excel("Quarterly/02_04_3_trim_2006.xlsx", skip = 1)
colnames(Q32006)[1] <- "Entidad.federativa"
colnames(Q32006)[2] <- "Saldo.total"

Q3_2006 <- Q32006 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2006` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2006`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2006$id <- seq_len(nrow(Q3_2006))


Q42006 <- read_excel("Quarterly/02_04_4_trim_2006.xlsx", skip = 1)
colnames(Q42006)[1] <- "Entidad.federativa"
colnames(Q42006)[2] <- "Saldo.total"

Q4_2006 <- Q42006 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2006` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2006`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2006$id <- seq_len(nrow(Q4_2006))

merged_data_2006 <- Q1_2006 %>%
  left_join(Q2_2006, by = "id") %>%
  left_join(Q3_2006, by = "id") %>%
  left_join(Q4_2006, by = "id")

merged_data_2006  <- merged_data_2006 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```



```{r get data 2005 , echo=FALSE}
############################ 2005 ############################    

library(tidyr)

Q12005 <- read_excel("Quarterly/02_04_1_trim_2005.xlsx", skip = 1)
colnames(Q12005)[1] <- "Entidad.federativa"
colnames(Q12005)[2] <- "Saldo.total"

Q1_2005 <- Q12005 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`1Q2005` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `1Q2005`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q1_2005$id <- seq_len(nrow(Q1_2005))


Q22005 <- read_excel("Quarterly/02_04_2_trim_2005.xlsx", skip = 1)
colnames(Q22005)[1] <- "Entidad.federativa"
colnames(Q22005)[2] <- "Saldo.total"

Q2_2005 <- Q22005 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`2Q2005` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `2Q2005`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q2_2005$id <- seq_len(nrow(Q2_2005))


Q32005 <- read_excel("Quarterly/02_04_3_trim_2005.xlsx", skip = 1)
colnames(Q32005)[1] <- "Entidad.federativa"
colnames(Q32005)[2] <- "Saldo.total"

Q3_2005 <- Q32005 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`3Q2005` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `3Q2005`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q3_2005$id <- seq_len(nrow(Q3_2005))


Q42005 <- read_excel("Quarterly/02_04_4_trim_2005.xlsx", skip = 1)
colnames(Q42005)[1] <- "Entidad.federativa"
colnames(Q42005)[2] <- "Saldo.total"

Q4_2005 <- Q42005 %>%
  slice(1:(n() - 4)) %>%                # Remove the last 4 rows
  rename(`4Q2005` = `Saldo.total`) %>%  # Rename "Saldo.total" to "1Q2018"
  rename(EntidadFed = `Entidad.federativa`) %>% # Rename "Entidad.federativa" to "EntidadFed"
  select(EntidadFed, `4Q2005`) %>%      # Select only the desired columns
  drop_na()                             # Remove rows where any column has NA
                          # Remove rows where any column has NA
Q4_2005$id <- seq_len(nrow(Q4_2005))

merged_data_2005 <- Q1_2005 %>%
  left_join(Q2_2005, by = "id") %>%
  left_join(Q3_2005, by = "id") %>%
  left_join(Q4_2005, by = "id")

merged_data_2005  <- merged_data_2006 %>%
  select(-EntidadFed.y, -EntidadFed.x.x, -EntidadFed.y.y)

```


```{r merge data years  , echo=FALSE}

merged_data_2019_2020 <- merged_data_2019 %>%
  left_join(merged_data_2020, by = "id")

merged_data_2019_2020 <- merged_data_2019 %>%
  left_join(merged_data_2020, by = "id")

merged_data_2019_2020_2021 <- merged_data_2019_2020 %>%
  left_join(merged_data_2021, by = "id")

merged_data_2019_2020_2021_2022 <- merged_data_2019_2020_2021 %>%
  left_join(merged_data_2022, by = "id")

merged_data_2019_2020_2021_2022_2023 <- merged_data_2019_2020_2021_2022 %>%
  left_join(merged_data_2023, by = "id")

merged_data_2019_2020_2021_2022_2023_2024 <- merged_data_2019_2020_2021_2022_2023 %>%
  left_join(merged_data_2024, by = "id")

merged_data_2018_2019_2020_2021_2022_2023_2024 <- merged_data_2019_2020_2021_2022_2023 %>%
  left_join(merged_data_2018, by = "id")

merged_data_2017_2018_2019_2020_2021_2022_2023_2024 <- merged_data_2018_2019_2020_2021_2022_2023_2024 %>%
  left_join(merged_data_2017, by = "id")


merged_data_2017_2018_2019_2020_2021_2022_2023_2024 <- merged_data_2017_2018_2019_2020_2021_2022_2023_2024 %>%
  select(-EntidadFed.x.x, -EntidadFed.x.y, -EntidadFed.x.x.x, -EntidadFed.x.x.x.x, -EntidadFed.x.y.y, -EntidadFed.x.y.y.y,-id)



```



#Data Glimpse
```{r get data , echo=FALSE}
View(Q2_2019)
```

#Data Structure - Explanation:

* For Amount we used "Monto Original Contratado"
* For Maturirities we used "Fecha de Vencimiento" (note that there are some values)
* Other important dates are "Contract date", "Inscription Date" and "Days agreed for paying", we can add the "Contract date" or the "Inscription date" plus the "Days agreed for paying".
* For rates we used "Tasa Efectiva" but we can also use the "Tasa de interés", "Sobretasa", "Porcentaje Afectado" and "Tasa garantizada". 


```{r municipalities , echo=FALSE}
# Create a new data frame with rows containing "municipio"
registro_deuda_municipal_1 <- registro_deuda_1_[grepl("municipio", registro_deuda_1_$DEUDOR.U.OBLIGADO.2, ignore.case = TRUE), ]
# Create a new data frame with rows containing "municipal"

registro_deuda_municipal_2 <- registro_deuda_1_[grepl("municipal", registro_deuda_1_$DEUDOR.U.OBLIGADO.2, ignore.case = TRUE), ]
registro_deuda_municipal <- rbind(registro_deuda_municipal_1, registro_deuda_municipal_2)
registro_deuda_municipal <- registro_deuda_municipal[, c("MONTO.ORIGINAL.CONTRATADO.7/", "DEUDOR.U.OBLIGADO.2/", "FECHA.DE.VENCIMIENTO.27/", "TASA.EFECTIVA.13/")]
write.xlsx(registro_deuda_municipal, file = "registro_deuda_municipal.xlsx")
```


# Filter by states 
```{r municipalities , echo=FALSE}

# Create a new data frame with rows containing "Estado"
registro_deuda_estatal_1 <- registro_deuda_1_[grepl("Estado", registro_deuda_1_$DEUDOR.U.OBLIGADO.2, ignore.case = TRUE),]
# Create a new data frame with rows containing "Estatal"
registro_deuda_estatal_2 <- registro_deuda_1_[grepl("Estatal", registro_deuda_1_$DEUDOR.U.OBLIGADO.2, ignore.case = TRUE),]
registro_deuda_estatal <- rbind(registro_deuda_estatal_1, registro_deuda_estatal_2)
registro_deuda_estatal <- registro_deuda_estatal[, c("MONTO.ORIGINAL.CONTRATADO.7/", "DEUDOR.U.OBLIGADO.2/", "FECHA.DE.VENCIMIENTO.27/", "TASA.EFECTIVA.13/")]
write.xlsx(registro_deuda_estatal, file = "resgistro_deuda_estatal.xlsx")

```

